env:
    CIRRUS_CLONE_DEPTH: 1
    #gcp_credentials: "ENCRYPTED[52d9731bab8dea7e2f71cbd5162d10dc57e1c8a9e91779b86758948763c13b48d21681a2f0f20a8e6c5133dfbb445c47]"
    Nusantara: "ENCRYPTED[!35640039e327d731ce3a0c030d67cb49429e5d9a4d1b92ff6aae0838c5ed135551f799e89ce8ec5293168ed2e2b62962!]"
    rclone_config: "ENCRYPTED[!dd7f114c64f1146c55bfa13af0028eec1a6c1b1bb9f92c054a0107daa11b394595fc32657ae9ca3c3bd64ed51a9d7818!]"
    TG_TOKEN: "ENCRYPTED[!ae64f4fd826ab2764fcb72fb8656f12aa280fae3ca426bba90c70d53b08b7e08cc3a1f94af7f8144e2973d527456cd1b!]"
    TG_CHAT_ID: "ENCRYPTED[!029352af8b1128d0d5cd801d06d2b1a11d0607221a92831ec33f68d87adeaa4165b6febf0226a205dc7cf5dd7e788d1d!]"
    SF_USERNAME: "ENCRYPTED[!435fc7d0559813d9b9e5ba052a58ad78ed0704471b648ecbb19dbb88a904a12ffb28d9f44258e0610d8af674da396ab4!]"
    SF_PASS: "ENCRYPTED[!122bab13210e1e2719e0362bc5d601afde38ecfb19797a74226d64a4ade63bfd5d303a2e685b0288fb135506a12e0448!]"
    ROM_PROJECT: "nad-13"
    GIT: "ENCRYPTED[!6e5fc0ab59c5368ee06054cea34ff598363570c6e9942ba123c26172c26ceb18241a9ba64385c48705fb464e1343f3d7!]"
    #DOCKER_HUB_PWD: "ENCRYPTED[45147df4523a226976c523c65f2a84d3361dff9316c97a1cef1aee1ac524b430d5a4b48e18f28603109a27f52bc7a721]"
    TOKEN: "ENCRYPTED[!01065c017f16aad96d9c897624dc63839f568a078ec617934627caeedecf8c8b85d81d247547f1b87334e7576363dd28!]"

task:
  name: Syncing, Building and Uploading
  timeout_in: 4h
  container:
    image: arifjenong/rom:nad
    cpu: 8
    memory: 32G

  Env_background_script:
      - ./env.sh

  Download_background_script:
      #- time rclone copy znxtproject:ccache/$ROM_PROJECT/ccache.tar.gz ~ -P
      - time rclone copy znxtproject:ccache/$ROM_PROJECT/ccache.tar.zst ~ -P
      - ./setup.sh

  Out_background_script:
      - cd ~/rom
      - time rclone copy znxtproject:ccache/$ROM_PROJECT/out.tar.zst ~/rom -P
      - time tar -xaf out.tar.zst
      - time rm -rf out.tar.zst

  Retry_background_script:
      - ./retry.sh

  Build_script:
      - ./repo.sh

  UploadROM_background_script:
      - cd ~/rom/out/target/product/maple_dsds
      - ls -lh
      - time rclone copy $(ls *maple*OFFICIAL*.zip) znxtproject:NusantaraProject/maple_dsds -P && time rclone copy $(ls *.md5sum) znxtproject:NusantaraProject/maple_dsds -P && ls -lh
      #- curl -s https://api.telegram.org/$TG_TOKEN/sendMessage -d chat_id=$TG_CHAT_ID -d text="Build $(cd ~/rom/out/target/product/maple_dsds && ls *UNOFFICIAL*.zip) Uploaded Successfully!"

  UploadCc_script:
      - ./build_zip.sh

  SF_script:
      - cd ~ && rm -rf rom/out/product
      #- ./sf.sh
